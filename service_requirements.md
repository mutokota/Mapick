# サービス要件（現状版 / 訪問ステータス・評価を除去）

## 1. サービス概要
- 目的：お気に入りのお店を **地図＋一覧で記録・振り返り**できる個人用ブックマーク  
- 想定利用：**お店にいる時点**で登録（現在地利用が前提）  
- 対象端末：スマホ優先（レスポンシブ対応）

---

## 2. 主要ユースケース
1. 来店中にお店を登録（現在地→住所補完→コメント・タグ付け）  
2. 過去に登録した店を地図または一覧から見返す  
3. タグ・カテゴリ・検索条件で絞り込んで再訪先を探す  

---

## 3. 機能要件（MVP）

### 登録/編集
- 店名（必須）、コメント（任意）、画像1枚（任意）  
- **現在地取得**で緯度・経度を保存（権限ダイアログあり）  
- **逆ジオコーディングで住所補完**（ユーザー編集可）  
- タグ（複数可、自由入力）  
- カテゴリ（単一選択、固定集合）  
- 地図上のピン微調整（ドラッグで補正）  

### 表示・振り返り
- 地図表示（ピン／タップで詳細カード）  
- 一覧表示（カード形式）  
- 詳細表示（地図ミニビュー＋住所＋タグ＋カテゴリ＋コメント＋画像）  

### 検索・フィルタ
- キーワード検索（店名・コメント）  
- フィルタ：カテゴリ、タグ（複数）  
- **地理フィルタ**：地図表示範囲（ビューポート内）  
- 並び替え：新着／名前順／距離順（距離は現在地利用時のみ）  

### マップ体験
- ピンのクラスタリング  
- カテゴリ別のピン色／アイコン  
- 現在地表示（青点＋精度円、ON/OFF）  
- 地図長押しで仮ピン配置 → 登録フォームに反映  

---

## 4. 非機能要件
- **性能**：  
  - 初期表示 LCP ≦ 3s  
  - 主要操作応答 ≦ 100ms  
- **セキュリティ／プライバシー**：  
  - HTTPS必須、位置情報利用の目的を明示  
  - ON/OFF 切替可能、デフォルトは非公開保存  
- **データ保全**：  
  - 日次バックアップ  
  - CSV/JSON エクスポート（MVPまたは直後）  
- **ログ/計測**：登録数、検索回数、地図滞在時間（匿名）

---

## 5. データ項目（最小）
- 店舗：  
  - id / name / comment / lat / lon / accuracy  
  - formatted_address / address_parts(JSON)  
  - category_id  
  - tags[*]  
  - image_url  
  - created_at / updated_at  
- タグ：id / name（ユニーク）  
- カテゴリ：id / name（固定集合）  
- 位置・住所：WGS84(EPSG:4326)、逆ジオ結果の source と confidence も保持  

---

## 6. 位置関連の方針
- **現在地取得のみ採用**（登録時は店内利用を前提）  
- 逆ジオコーディングで住所を補完  
- フォワード・ジオコーディング（住所→座標）は **今回不要**  
- 微調整は地図上でピンをドラッグ  

---

## 7. 画面（MVP）
1. ホーム（地図）  
   - 検索バー、フィルタドロワー、現在地ボタン、登録ボタン  
2. 一覧  
   - 検索・フィルタ反映のカードリスト  
3. 登録／編集  
   - 店名、コメント、画像、タグ、カテゴリ、現在地取得→住所補完、地図微調整  
4. 詳細  
   - 店舗情報の閲覧＋編集導線  

---

## 8. スコープ外（現時点でやらない）
- フォワード・ジオコーディング（住所/店名→座標）  
- 公開共有／他ユーザーとのコラボ  
- 高度なオフライン地図キャッシュ  
- 画像複数枚、営業時間自動取得 等  

---

## 9. 受け入れ基準（抜粋）
- 位置許可がなくても登録画面は開ける（ただし現在地取得は不可表示）  
- 現在地→住所補完→微調整→保存の流れが自然に完結する  
- 検索・フィルタ結果が地図と一覧で一致する  
- 地図の表示範囲変更で地理フィルタが反映される  
- スマホ幅（360〜430px）で主要操作が折り返しなし  
